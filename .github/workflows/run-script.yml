name: 福田e家签到任务

on:
  workflow_dispatch:  # 允许手动触发
  schedule:
    # 每天北京时间上午9点运行（UTC时间1:00）
    - cron: '0 1 * * *'
  push:
    paths:
      - '福田e家_Loader.py'  # 当此脚本更新时自动运行

jobs:
  run-futian:
    runs-on: ubuntu-latest
    timeout-minutes: 30  # 设置30分钟超时
    env:
      TZ: Asia/Shanghai  # 设置时区为中国标准时间

    steps:
    - name: 检出代码
      uses: actions/checkout@v4

    - name: 设置Python环境
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'  # 指定Python版本

    - name: 安装依赖
      run: |
        python -m pip install --upgrade pip
        pip install requests pycryptodome
        
    - name: 调试信息（用于问题排查）
      run: |
        echo "当前工作目录: $(pwd)"
        echo "文件列表:"
        ls -la
        echo "Python版本:"
        python --version
        echo "huaji_futian变量: $huaji_futian"
        echo "USERNAME变量: $USERNAME"
        
    - name: 运行福田e家签到脚本
      run: python 福田e家_Loader.py
      env:
        # 从GitHub Secrets获取敏感信息
        huaji_futian: ${{ secrets.HUAJI_FUTIAN }}  # 关键添加
        
    - name: 上传日志
      if: always()  # 无论任务成功失败都上传
      uses: actions/upload-artifact@v4
      with:
        name: futian-logs
        path: |
          *.log
          *.txt
        retention-days: 7  # 设置文件保留天数
