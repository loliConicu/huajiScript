name: 福田e家签到任务

on:
  workflow_dispatch:  # 允许手动触发
  schedule:
    # 每天北京时间上午9点运行（UTC时间1:00）
    - cron: '0 1 * * *'
  push:
    paths:
      - '福田e家_Loader.py'  # 当此脚本更新时自动运行

jobs:
  run-futian:
    runs-on: ubuntu-latest
    timeout-minutes: 30  # 设置30分钟超时
    env:
      TZ: Asia/Shanghai  # 设置时区为中国标准时间

    steps:
    - name: 检出代码
      uses: actions/checkout@v4  # 使用最新版本

    - name: 设置Python环境
      uses: actions/setup-python@v4  # 使用最新版本
      with:
        python-version: '3.10'  # 指定Python版本

    - name: 安装依赖
      run: |
        python -m pip install --upgrade pip
        pip install requests pycryptodome
        
    - name: 运行福田e家签到脚本
      run: python 福田e家_Loader.py
      env:
        # 从GitHub Secrets获取敏感信息
        USERNAME: ${{ secrets.FUTIAN_USERNAME }}
        PASSWORD: ${{ secrets.FUTIAN_PASSWORD }}
        # 可添加其他所需环境变量

    # 更新后的日志上传步骤
    - name: 上传日志
      if: always()  # 无论任务成功失败都上传
      uses: actions/upload-artifact@v4  # 使用最新版本
      with:
        name: futian-logs
        path: |
          *.log
          *.txt
        retention-days: 7  # 设置文件保留天数
